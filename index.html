<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The SP-404MK2 Guide: Ultimate Edition</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="A comprehensive, self-contained guide to the Roland SP-404MK2. Discover essential tips, advanced techniques, workflow hacks, effect lists, drum patterns, and button combos for sampling, patterns, DJing, and more. Your ultimate resource for mastering the SP-404MK2.">
    <meta name="keywords" content="SP-404MK2, SP404MKII, Roland SP-404, Sampler, Beatmaker, Looper, Effects, Sampling, Resampling, TR-REC, Pattern Sequencer, DJ Mode, Chop, Skip Back, Automation, MIDI Sync, External Control, Firmware Update, Import Samples, Export Samples, Backup, Troubleshooting, Koala Sampler, Serato DJ, Serato Studio, Lofi Beats, Hip-hop Production, Live Performance, Finger Drumming, Vinyl Simulation, How to, Tutorial, Guide, Tips and Tricks, Best Practices, Workflow, Setup, Charles Paris">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --sp-dark: #1A1A1D;
            --sp-card-bg: #1E1E1E;
            --sp-accent: #00C0FF; /* Roland Blue */
            --sp-accent-hover: #57d7ff;
            --sp-muted: #4A4A50;
            --sp-muted-hover: #5A5A60;
            --sp-text-light: #E0E0E0;
            --sp-text-dark: #A0A0A0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--sp-dark);
            color: var(--sp-text-light);
            padding-top: 2rem;
            padding-bottom: 4rem;
            background-image: linear-gradient(135deg, #101012 0%, #1A1A1D 100%);
            background-size: 200% 200%;
            animation: gradient-animation 15s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card {
            background-color: var(--sp-card-bg);
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-7px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
        }
        .tip-category-button, .header-button {
            background-color: var(--sp-muted);
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            white-space: nowrap;
        }
        .tip-category-button:hover, .header-button:hover {
            background-color: var(--sp-muted-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        .tip-category-button.active {
            background-color: var(--sp-accent);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
        }
        .tip-item {
            background-color: #2A2A30;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid var(--sp-accent);
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 50;
        }
        .modal-content {
            background-color: var(--sp-card-bg);
            border-radius: 16px;
        }
        .close-button {
            color: #F0F0F0;
            font-size: 1.8rem;
            transition: color 0.2s;
        }
        .close-button:hover {
            color: #FF8888;
        }
        .search-input {
            background-color: var(--sp-dark);
            border: 1px solid var(--sp-muted);
            color: #F0F0F0;
            padding: 14px 20px;
            border-radius: 10px;
            outline: none;
            width: 100%;
            max-width: 450px;
        }
        .search-input::placeholder {
            color: var(--sp-text-dark);
        }
        .search-button, #download-pdf-button, .more-info-button, #back-to-tip-button {
            background-color: var(--sp-accent);
            color: #ffffff;
            padding: 12px 22px;
            border-radius: 10px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .search-button:hover, #download-pdf-button:hover, .more-info-button:hover, #back-to-tip-button:hover {
            background-color: var(--sp-accent-hover);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        .related-tips-container, .suggested-tip-container {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--sp-muted);
        }
        .suggested-tip-box, .related-tip-box {
            background-color: #252525;
            border: 1px solid var(--sp-muted);
            border-left: 5px solid var(--sp-accent);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .suggested-tip-box:hover, .related-tip-box:hover {
            background-color: #333;
        }
        .tip-icon {
            margin-right: 12px;
            color: var(--sp-accent);
            font-size: 1.1em;
        }
        .copy-button {
            background-color: var(--sp-muted);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .copy-button:hover {
            background-color: var(--sp-muted-hover);
        }
        footer { border-top: 1px solid var(--sp-muted); padding-top: 2rem; margin-top: 4rem; }
        .footer-link { transition: color 0.2s ease-in-out; color: var(--sp-text-dark); }
        .footer-link:hover { color: var(--sp-accent); }
        h1, h2, h3, h4 { color: var(--sp-text-light); }
        p, li { color: #b0b0b0; }
        .main-title {
            background: -webkit-linear-gradient(45deg, #57d7ff, #00C0FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .drum-pattern-grid {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 4px;
            background-color: #252525;
            padding: 8px;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        .drum-step {
            width: 100%;
            padding-bottom: 100%; /* Aspect ratio 1:1 */
            background-color: #4A4A50;
            border-radius: 4px;
        }
        .drum-step.active {
            background-color: var(--sp-accent);
        }
        .combo-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .combo-table th, .combo-table td {
            border: 1px solid var(--sp-muted);
            padding: 12px;
            text-align: left;
        }
        .combo-table th {
            background-color: var(--sp-muted);
        }
        .combo-key {
            background-color: var(--sp-text-dark);
            color: var(--sp-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
        }
        .details-view { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center px-4">

    <header class="w-full max-w-6xl text-center mb-12 flex flex-col items-center">
        <div class="w-full flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
            <div class="w-full md:w-auto flex justify-center">
                 <button id="sp-sauce-button" class="header-button w-full sm:w-auto"><i class="fa-solid fa-pepper-hot mr-2"></i>SP Sauce</button>
            </div>
            <div class="flex flex-wrap justify-center gap-2">
                <button id="effects-list-button" class="header-button"><i class="fas fa-sliders mr-2"></i>FX List</button>
                <button id="button-combos-button" class="header-button"><i class="fas fa-keyboard mr-2"></i>Button Combos</button>
            </div>
        </div>

        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold main-title mb-4">The SP-404MK2 Guide</h1>
        <p class="text-lg sm:text-xl lg:text-2xl text-gray-300">Unlock the full potential of your Roland SP-404MK2!</p>
    </header>

    <main class="w-full max-w-6xl">
        <div class="flex flex-col sm:flex-row justify-center items-center mb-12 gap-4 w-full px-4 sm:px-0">
            <input type="search" id="search-input" placeholder="Search tips..." class="search-input w-full sm:w-auto flex-grow sm:flex-grow-0">
            <button id="search-button" class="search-button w-full sm:w-auto">Search</button>
        </div>

        <section class="mb-16 p-6 bg-[#1E1E1E] rounded-lg shadow-xl">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">Essential Tips to Get You Started <i class="fa-solid fa-bolt tip-icon"></i></h2>
            <div id="top-tips-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <div class="mb-12">
            <h3 class="text-2xl font-bold text-center mb-6">Filter by Category</h3>
            <div id="category-filter-container" class="flex flex-wrap justify-center gap-4"></div>
        </div>

        <section id="tips-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></section>
        
        <div class="flex justify-center mt-16">
            <button id="download-pdf-button" class="search-button"><i class="fa-solid fa-file-pdf"></i> Download All Tips as PDF</button>
        </div>
    </main>

    <!-- Tip Modal -->
    <div id="tip-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-3xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <div id="main-tip-view">
                <h3 id="modal-title" class="text-3xl font-semibold mb-2"></h3>
                <p id="modal-description" class="text-lg leading-relaxed"></p>
                <p id="modal-source" class="text-sm mt-6"></p>
                <div class="flex flex-wrap gap-2 mt-4">
                    <button id="copy-tip-button" class="copy-button"><i class="fa-solid fa-copy"></i> Copy Tip</button>
                    <button id="more-info-button" class="more-info-button"><i class="fa-solid fa-circle-info"></i> More Info</button>
                </div>
            </div>
            <div id="details-view" class="hidden">
                 <h3 id="details-title" class="text-3xl font-semibold mb-2"></h3>
                 <div id="details-content" class="text-lg leading-relaxed prose prose-invert max-w-none"></div>
                 
                 <div id="related-tips-container" class="related-tips-container">
                    <h4 class="text-2xl font-semibold mb-4">Related Tips</h4>
                    <div id="related-tips-list" class="space-y-3"></div>
                 </div>

                 <div id="suggested-tip-container" class="suggested-tip-container">
                    <h4 class="text-2xl font-semibold mb-4">Suggested Tip</h4>
                    <div id="suggested-tip-box-content"></div>
                 </div>
                 
                 <button id="back-to-tip-button" class="search-button mt-6"><i class="fa-solid fa-arrow-left"></i> Back to Tip</button>
            </div>
        </div>
    </div>
    
    <!-- SP Sauce Modal -->
    <div id="sp-sauce-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-sp-sauce-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6"><i class="fa-solid fa-pepper-hot mr-3"></i>SP Sauce: 35 Drum Patterns</h3>
            <div id="sp-sauce-content" class="text-lg leading-relaxed"></div>
        </div>
    </div>
    
    <!-- Effects List Modal -->
    <div id="effects-list-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-effects-list-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6">FX List</h3>
            <input type="search" id="effects-search-input" placeholder="Search effects..." class="search-input mb-6 w-full">
            <div id="effects-list-container" class="text-lg leading-relaxed"></div>
        </div>
    </div>
    
    <!-- Button Combos Modal -->
    <div id="button-combos-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-button-combos-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6">Button Combination List</h3>
            <div id="button-combos-container" class="text-sm leading-relaxed"></div>
        </div>
    </div>

    <footer class="w-full max-w-6xl text-center text-gray-500">
        <p class="mb-4">SP-404MK2 Guide by <a href="https://www.charlesparis.com" target="_blank" class="font-bold footer-link">Charles Paris</a></p>
        <div class="flex justify-center items-center gap-6 text-2xl">
            <a href="https://www.youtube.com/c/charlesparis" target="_blank" class="footer-link"><i class="fab fa-youtube"></i></a>
            <a href="https://www.instagram.com/charlesparis" target="_blank" class="footer-link"><i class="fab fa-instagram"></i></a>
            <a href="https://www.twitter.com/charlesparis" target="_blank" class="footer-link"><i class="fab fa-twitter"></i></a>
        </div>
    </footer>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const { jsPDF } = window.jspdf;

        const categories = {
            concepts: { name: "Concepts", icon: 'fa-solid fa-lightbulb' },
            sampling: { name: "Sampling", icon: 'fa-solid fa-wave-square' },
            effects: { name: "Effects", icon: 'fa-solid fa-sliders-h' },
            patterns: { name: "Patterns", icon: 'fa-solid fa-grip-horizontal' },
            tempo: { name: "Tempo", icon: 'fa-solid fa-tachometer-alt' },
            djmode: { name: "DJ Mode", icon: 'fa-solid fa-compact-disc' },
            shortcuts: { name: "Shortcuts", icon: 'fa-solid fa-keyboard' },
            utility: { name: "Utility", icon: 'fa-solid fa-cogs' },
            koala: { name: "Koala Sampler", icon: 'fa-solid fa-headphones' },
            serato_studio: { name: "Serato Studio", icon: 'fa-solid fa-laptop-code' },
            serato_dj: { name: "Serato DJ", icon: 'fa-solid fa-record-vinyl' },
            midi: { name: "MIDI", icon: 'fa-solid fa-music' },
            troubleshooting: { name: "Troubleshooting", icon: 'fa-solid fa-exclamation-triangle' },
            pro_tips: { name: "Pro Tips", icon: 'fa-solid fa-star' }
        };

        const tipsData = [
            // --- CONCEPTS (9 Tips) ---
            { category: "concepts", title: "Understanding Samples", description: "Samples are recorded audio data with settings like loop points and effects routing. They are assigned to pads or used within patterns.", source: "Reference Manual p.10", context: "The SP-404MK2 is a sample-based instrument at its core. Every sound you hear, from a drum hit to a melodic loop, is a sample. Understanding that each sample is an independent entity with its own parameters (volume, pitch, effects routing) is crucial to mastering the workflow." },
            { category: "concepts", title: "Understanding Patterns", description: "Patterns define the playback order of samples, forming the basis for songs. Record your performances into patterns using the sequencer.", source: "Reference Manual p.11", context: "Patterns are sequences of your pad presses recorded over time. You can record in real-time or use the TR-REC step sequencer for more precise programming. Chaining these patterns together allows you to build a full song structure." },
            { category: "concepts", title: "Banks and Projects Structure", description: "A 'bank' holds 16 samples and 16 patterns (10 banks A-J). A 'project' manages 10 banks of samples and patterns, with 16 projects available.", source: "Reference Manual p.11", context: "Think of a project as a complete song or live set. Within that project, you have 10 banks (A-J) to organize your sounds and sequences. This structure allows you to have up to 160 samples and 160 patterns per project, providing ample space for complex arrangements." },
            { category: "concepts", title: "SP-404MK2 Panel Overview", description: "Familiarize yourself with the main sections: Volume, Control knobs, Display, Effect buttons, Pattern Sequencer, Sample Edit, Sampling, Sample Mode, Pads, Banks, Shift, Hold, Ext Source, Sub Pad.", source: "Reference Manual p.5", context: "Knowing the layout is key. The left side is for input/output and effects. The center is for editing and sequencing. The right side is for playing and triggering samples. The [SHIFT] button is your key to unlocking secondary functions for almost every control." },
            { category: "concepts", title: "Connecting External Gear", description: "Connect amps/speakers to LINE OUT, headphones to PHONES. Use LINE IN for instruments, INPUT for mic/guitar (adjust [MIC/GUITAR] switch for impedance).", source: "Reference Manual p.12-13", context: "The SP-404MK2 is a versatile hub. You can sample from a turntable into LINE IN, a guitar into the front INPUT, or even a phone via the USB-C port. Outputs can go to speakers, a mixer, or an audio interface." },
            { category: "concepts", title: "USB Audio & MIDI Connection", description: "Connect to computer/mobile via USB-C for audio and MIDI. No driver needed. Ensure correct USB cable (data-enabled) and sufficient power (1.5A+ for USB power).", source: "Reference Manual p.13-15", context: "The USB-C connection is powerful. It allows you to stream audio directly from your computer or phone into the SP-404MK2 for sampling, and also stream the SP's output back to your computer for recording in a DAW. It also handles all MIDI communication." },
            { category: "concepts", title: "Powering the Unit", description: "Power via AC adaptor (included), USB-C (1.5A+ source), or 6 AA batteries (Ni-MH/Alkaline). Prioritization: DC IN > USB > Batteries.", source: "Reference Manual p.14-15", context: "This flexibility makes the SP-404MK2 incredibly portable. You can produce on the go with batteries or a USB power bank, and then plug into the AC adapter for longer studio sessions without worrying about power." },
            { category: "concepts", title: "Turning Power On/Off Safely", description: "Always turn volume down before powering on/off. Turn on connected devices then amp/speakers after SP-404MK2. Reverse for power off.", source: "Reference Manual p.15-16", context: "This simple habit protects your speakers and headphones from loud pops that can occur when devices are powered on or off. It's a professional practice that will extend the life of your equipment." },
            { category: "concepts", title: "Sample Mode Display", description: "Top screen shows Project number, Bank/sample number, Assigned BUS FX, Fixed Velocity status, Power supply type (DC/USB/BAT), and BPM of selected sample.", source: "Reference Manual p.16", context: "The display provides crucial at-a-glance information. Knowing how to read it quickly will tell you what project and bank you're in, what effects are active, and the tempo of the selected sound, which is vital for staying oriented during a performance or session." },

            // --- SAMPLING (32 Tips) ---
            { category: "sampling", title: "Basic Sampling Setup", description: "Press [REC], select a blinking red pad, then [REC] again to start/stop recording. Adjust tempo with [CTRL 1] and input volume with [CTRL 3].", source: "Reference Manual p.33-35", topTip: true, context: "This is the most direct way to capture audio. Before you start, ensure your input source is selected correctly (e.g., LINE IN, MIC/GUITAR, or USB) and that the input level is not clipping (peaking in the red)." },
            { category: "sampling", title: "Count-In Before Sampling", description: "Add a count-in: Hold [SHIFT] + pad [10] to cycle through count-in options (1MEAS, 2MEAS, WAIT, OFF). 'WAIT' starts recording when audio input exceeds a set level.", source: "Reference Manual p.35", context: "The 'WAIT' function is particularly useful for sampling yourself playing an instrument. It ensures that recording only begins when you start playing, so you don't have to trim silence from the beginning of your sample later." },
            { category: "sampling", title: "Automatic End Point (END SNAP)", description: "Enable 'END Snap ON' by pressing [START/END] after [REC] to automatically set the sample's end point to the nearest beat.", source: "Reference Manual p.35-36", context: "When sampling a loop that has a specific tempo, END SNAP is a huge time-saver. It helps you create perfectly timed loops without needing to manually trim the end point with perfect precision." },
            { category: "sampling", title: "Resampling for Effects & Merging", description: "Resample to combine multiple samples or include effects: Press [RESAMPLE], set ROUTING to 'Mix' in RECORD SETTING. This captures the SP-404's output.", source: "Reference Manual p.37-38", context: "Resampling is a core SP workflow. It allows you to 'print' effects onto a sample, freeing up your BUS FX for other uses. You can also use it to layer multiple sounds together into a single, cohesive sample." },
            { category: "sampling", title: "Skip-Back Sampling", description: "Capture past audio (up to 25s/40s max): If [MARK] blinks, press it to save the last moments of audio.", source: "Reference Manual p.38-39", topTip: true, context: "Skip-Back is always listening. This is a lifesaver for capturing spontaneous ideas or happy accidents while you're just jamming. If you play something great without being in record mode, the blinking [MARK] button is your chance to save it." },
            { category: "sampling", title: "Looper Function", description: "Record sounds in a loop: Set 'MARK Function' to 'Looper' in UTILITY > SYSTEM. Press [MARK], configure parameters, then [REC].", source: "Reference Manual p.41", context: "The looper is designed for building up layers of audio in real-time. It's great for live performance or for creating dense, evolving textures by overdubbing sounds on top of each other." },
            { category: "sampling", title: "Sound Generator", description: "Create synth sounds directly on the unit: Hold [SHIFT] + [RECORD SETTING]. Adjust Type (waveform), Freq, Level, Pad Length, Duty Cycle, Balance with [CTRL] knobs. Play with pads, then [REC] to export to a pad.", source: "Reference Manual p.43", context: "This is a hidden gem for sound design. You can create basic synth tones (sine, square, saw, noise) without needing any external gear. It's perfect for making your own sub-basses, synth stabs, or riser effects." },
            { category: "sampling", title: "Setting Playback & Loop Regions (START/END)", description: "Trim unnecessary parts of a sample or set loop points: Press [START/END]. Use [CTRL 1] for start, [CTRL 2] for loop, [CTRL 3] for end. [SHIFT] + [CTRL] for fine-tuning. [DEL] to initialize.", source: "Reference Manual p.44", context: "This is one of the most fundamental editing tasks. Precisely setting the start and end points of your samples is key to tight-sounding beats and seamless loops. Use the zoom function ([VALUE] knob) to get a close-up view of the waveform for accuracy." },
            { category: "sampling", title: "Processing Samples (Truncate, Normalize, Emphasis)", description: "After setting START/END points, press [VALUE] knob in Sample Edit to access menu. Select TRUNCATE (trim), NORMALIZE (increase volume), or EMPHASIS (boost high-freq). Note: This directly alters the original sample.", source: "Reference Manual p.45", context: "These are destructive edits, meaning they permanently change the sample data. 'Truncate' is essential for saving memory by deleting unused parts of a sample. 'Normalize' is useful for making quiet samples louder without adding distortion." },
            { category: "sampling", title: "Marking & Splitting Samples", description: "Split a sample into multiple smaller samples using markers. Hold [SHIFT] + [START/END] to enter marker setting screen. Use [CTRL 1] to move cursor, then [MARK] to add markers.", source: "Reference Manual p.45-46", context: "This is the first step in the chopping workflow. By placing markers at the beginning of each drum hit or musical phrase, you prepare the sample to be split into individual sounds." },
            { category: "sampling", title: "Auto Mark Function", description: "Automatically add markers based on conditions: In marker setting screen, press [VALUE] knob, select 'AUTO MARK'. Choose TIME DIVISION (divide equally), LEVEL (by audio level), or TRANSIENT (by sharp attacks).", source: "Reference Manual p.47", context: "Auto Mark is a massive time-saver. 'Transient' mode is excellent for automatically finding the start of drum hits in a breakbeat. 'Time Division' is great for chopping a melodic loop into equal-sized pieces (e.g., 16 slices)." },
            { category: "sampling", title: "Chop: Split & Assign to Pads", description: "Split a sample at marker positions and assign resulting samples to separate pads: After adding markers, press [VALUE] knob, select 'ASSIGN TO PAD'. Choose destination pads, then press [VALUE] to confirm.", source: "Reference Manual p.48", context: "This is the final step of chopping. It takes all the slices you've created with markers and lays them out across the pads, turning your loop into a playable instrument. You can then re-sequence the chops to create a new melody or beat." },
            { category: "sampling", title: "Envelope Settings (Fade In/Out)", description: "Control how sample volume changes over time: Hold [SHIFT] + [PITCH/SPEED]. Adjust ATTACK (fade-in), HOLD (playback range), and RELEASE (fade-out) with [CTRL] knobs.", source: "Reference Manual p.48-49", context: "The envelope is a powerful sound-shaping tool. Use a short attack to remove clicks from the start of a sample. Use a longer release to make a sound fade out naturally instead of stopping abruptly. This is key for making your samples sound smooth and professional." },
            { category: "sampling", title: "Playing Back Samples (SAMPLE MODE)", description: "Press pads [1-16] to play samples. Unit enters Sample Mode when powered on (pads light orange). If not, press [EXIT] multiple times. If pads blink blue, press [EXIT] then [PATTERN SELECT].", source: "Reference Manual p.17", context: "This is the default mode of the SP-404MK2. It's where you'll spend most of your time triggering sounds and performing. The pads are velocity-sensitive, so how hard you press them affects the volume of the sample." },
            { category: "sampling", title: "Sample Playback Modes (Gate, One-shot, Loop)", description: "Sample playback depends on mode: 'Gate' (plays only while pad pressed), 'One-shot' (plays once to end, pad operations disabled), 'Loop' (plays repeatedly).", source: "Reference Manual p.17", context: "Choosing the right playback mode is crucial. Use 'Gate' for sustained sounds like basslines or pads. Use 'One-shot' for drum hits. Use 'Loop' for drum breaks or melodic phrases you want to repeat." },
            { category: "sampling", title: "Playing Back Only While Pad Pressed (GATE)", description: "Toggle gate function: Press [GATE] button. When on, samples play only while pads are pressed. Also affects [EXT SOURCE] button.", source: "Reference Manual p.18", context: "Gate mode gives you expressive control over the length of your samples. It's perfect for playing staccato notes or creating dynamic, rhythmic variations by changing how long you hold down the pads." },
            { category: "sampling", title: "Playing Back Samples Only One Time (One-shot Playback)", description: "Set sample playback to one-shot: Hold [VALUE] knob and press [GATE] button. [GATE] button blinks slowly. Loop function turns off automatically.", source: "Reference Manual p.19", context: "This is the standard mode for drum samples. Once you trigger the sample, it will play through to its end, regardless of whether you continue to hold the pad. This ensures your drum hits have a consistent length." },
            { category: "sampling", title: "Playing Back Samples Repeatedly (LOOP)", description: "Use loop function: Press [LOOP] button (lights up). Loop plays forward. To retrigger, hold [HOLD] + pad. To play in reverse, also press [REVERSE]. For ping-pong loop, hold [SHIFT] + [LOOP].", source: "Reference Manual p.19-20", context: "Loop mode is essential for working with drum breaks, melodic phrases, and atmospheric textures. The ping-pong loop feature ([SHIFT] + [LOOP]) can create interesting and unexpected rhythmic variations." },
            { category: "sampling", title: "Playing Back a Sample in Reverse (REVERSE)", description: "Play samples in reverse: Select sample. Press [REVERSE] button (lights up). Reverse playback starts from end or current position depending on 'Reverse Type' setting (System parameter).", source: "Reference Manual p.20", context: "Reversing samples is a classic sound design technique. It can turn a simple sound into something otherworldly. Try reversing cymbal crashes to create riser effects, or reversing vocal snippets for a surreal vibe." },
            { category: "sampling", title: "Playing Back Samples in Detailed Steps (ROLL)", description: "Repeatedly play samples at a set interval: Hold [ROLL] + pads [1-16]. Can play up to four samples as a roll. To roll during playback, press [ROLL] while sample is playing. Roll starts when finger lifted.", source: "Reference Manual p.20-21", context: "The Roll function is perfect for creating trap-style hi-hats, drum fills, and rhythmic stutter effects. You can change the roll speed in real-time for dynamic performances." },
            { category: "sampling", title: "Setting the Roll Interval", description: "Adjust how fast roll repeats: Hold [SHIFT] + [ROLL]. Cycle through 1/4, 1/8, 1/16, 1/32, 1/64 notes, and triplets. If interval longer than sample, sample loops. Shorten roll interval mid-play: Hold [ROLL] + turn [VALUE] knob clockwise.", source: "Reference Manual p.21-22", context: "Mastering the roll interval allows you to create complex and evolving rhythmic patterns. The ability to change the interval on the fly is a powerful performance feature." },
            { category: "sampling", title: "Setting a Fixed Sample Volume (FIXED VELOCITY)", description: "Force sample playback at max velocity (127): Hold [SHIFT] + pad [1]. 'FIXED VELOCITY ON' is shown. To cancel, repeat operation.", source: "Reference Manual p.22", context: "Fixed velocity is useful when you want every drum hit to have the same impact, mimicking the behavior of classic drum machines. It removes the human element of velocity variation for a more consistent, machine-like groove." },
            { category: "sampling", title: "Changing Sample Volume for Playback (16 VELOCITY)", description: "Change sample volume in steps: Select sample. Hold [SHIFT] + pad [2]. 16 VELOCITY screen appears. Press pads [1-16] to play sample at corresponding velocity. Press [EXIT] to exit.", source: "Reference Manual p.22-23", context: "This mode is great for programming more dynamic and human-sounding drum patterns. You can precisely control the volume of each hit, allowing you to add accents and ghost notes to your beats." },
            { category: "sampling", title: "Playing Back Samples in Scale Pitches (CHROMATIC)", description: "Play samples with changing pitches as a chromatic scale: Select sample. Hold [SHIFT] + pad [4]. Unit enters chromatic mode. Pads [1-16] correspond to keys. Turn [VALUE] knob to change key range. Press [REMAIN] to change play mode (LEGATO, MONO, POLY).", source: "Reference Manual p.23", context: "Chromatic mode turns any sample into a playable melodic instrument. Sample a single note from a synth or a vocal snippet, and you can instantly play melodies and basslines with it across the pads." },
            { category: "sampling", title: "Muting Playback of a Sample (Pad MUTE)", description: "Momentarily mute a sample: Play sample. Hold [SHIFT] + [REVERSE] + pad (sample) to mute. Muted pads light red. Cannot mute patterns. Hold [SHIFT] + [REVERSE] + [REMAIN] to lock mute mode. Unmute by repeating operation or pressing [EXIT] 4 times.", source: "Reference Manual p.24", context: "Pad Mute is a key performance feature for creating drops and breakdowns. You can instantly silence specific elements of your beat to create tension and release in your arrangement." },
            { category: "sampling", title: "Playing Multiple Pads at Same Time (PAD LINK GROUPS)", description: "Group up to four pads to play simultaneously: Hold [SHIFT] + pad [7]. PAD LINK GROUPS screen appears. Turn [VALUE] knob to select group (A-J). Press pads [1-16] to select samples for group. Press [EXIT] to finish.", source: "Reference Manual p.24", context: "Pad Link is perfect for layering sounds. You can link a kick drum sample with a sub-bass sample to create a powerful, unified low-end. Or, link multiple melodic samples to create instant chords." },
            { category: "sampling", title: "Merging Multiple Samples (SAMPLE MERGE)", description: "Combine multiple samples into a single pad: Hold [SHIFT] + [RESAMPLE]. Select 1-4 samples to merge. Turn [CTRL 1] (SUM/MUL) and [CTRL 3] (volume) to configure. Select save destination pad and press [VALUE] knob.", source: "Reference Manual p.24-25", context: "Sample Merge is similar to resampling, but it's specifically for combining existing samples into a new one. It's a quick way to create layered sounds without going through the full resampling process." },
            { category: "sampling", title: "Preventing Samples from Playing Simultaneously (MUTE GROUP)", description: "Group samples that should not layer: Hold [SHIFT] + pad [8]. MUTE GROUP screen appears. Turn [VALUE] knob to select group (A-J). Press pads [1-16] to select samples for group. Only the last played sample in a group is heard.", source: "Reference Manual p.25", context: "Mute groups are essential for realistic drum programming. By placing your open and closed hi-hat samples in the same mute group, you ensure that the closed hi-hat cuts off the open one, just like a real drum kit." },
            { category: "sampling", title: "Stopping All Sample Playback (STOP)", description: "Stop all currently playing samples and patterns: Press [EXIT] button quickly four times. Alternatively, hold [SHIFT] + [EXIT].", source: "Reference Manual p.26", context: "This is your emergency brake. If your performance gets messy or you just want to stop everything at once, this is the quickest way to do it." },
            { category: "sampling", title: "Pausing the Sound of a Sample (PAUSE)", description: "Pause currently playing sample: Hold [SHIFT] + [HOLD] button. All playing samples pause. Repeat to resume playback.", source: "Reference Manual p.26", context: "Pause is different from stop. It freezes the playback of all samples, allowing you to resume them from the exact same point. This can be used for creative stutter effects or for taking a quick break during a performance." },
            { category: "sampling", title: "Disabling Buttons in Live Mode", description: "Disable sampling/editing buttons during live performance: Hold [SHIFT] + long-press [REMAIN] (3 seconds). 'LIVE MODE ON' appears. Disabled buttons: [DEL], [REC], [RESAMPLE], [COPY], [MARK]. Repeat to turn off.", source: "Reference Manual p.26", context: "Live Mode is a safety feature that prevents you from accidentally making destructive edits during a performance. It's a must-use feature when playing a live set." },
            
            // --- EFFECTS (12 Tips) ---
            { category: "effects", title: "Applying BUS FX to Samples", description: "Assign effects to BUS 1/2: Press [BUS FX] to select bus (orange for BUS 1, blinking orange for BUS 2), then press an effect button (e.g., [FILTER+DRIVE]). Use [CTRL] knobs to edit parameters.", source: "Reference Manual p.27-28", context: "The BUS FX are your main performance effects. You can have two different effect chains (BUS 1 and BUS 2) running simultaneously, and you can route any sample to either bus or keep it dry (no effects)." },
            { category: "effects", title: "Assigning Effects Per Sample", description: "Apply effects to specific samples: Select BUS (1/2) with [BUS FX], then hold [REMAIN] + sample pad. Pad color indicates bus assignment (orange=BUS 1, green=BUS 2, white=DRY).", source: "Reference Manual p.29", context: "This per-sample routing is incredibly powerful. You can have your drums going through a compressor on BUS 1, your melody going through a delay on BUS 2, and your bassline playing dry, all at the same time." },
            { category: "effects", title: "Using MFX Effects", description: "Select MFX: Hold [MFX] + turn [VALUE] or [CTRL 3] knob. Release [MFX] to activate. Use [DJFX LOOPER] or [ISOLATOR] (while holding [MFX]) for more MFX types. Edit parameters with [CTRL] knobs.", source: "Reference Manual p.29", context: "MFX are multi-effects that can be applied to the entire mix or to specific buses. They offer more complex and creative sound-shaping possibilities than the standard BUS FX." },
            { category: "effects", title: "Editing Effect Parameters", description: "When an effect is on, the edit screen appears. Use [CTRL 1-3] for main parameters. Hold [VALUE] + [CTRL 1-3] for sub-parameters. Lock screen: Hold [REMAIN] + effect button.", source: "Reference Manual p.30", context: "Each effect has multiple parameters you can tweak. The three main control knobs give you hands-on control, and the [VALUE] knob combo unlocks deeper settings for fine-tuning your sound." },
            { category: "effects", title: "Effect Grab (Momentary Effects)", description: "Apply effects temporarily: Play a sample, then while holding [VALUE] knob, press an effect button. Effect is active only while the button is held.", source: "Reference Manual p.31", context: "Effect Grab is a performance feature that lets you punch in effects for short bursts. It's great for adding momentary stutters, filter sweeps, or delays without having to toggle the effect on and off." },
            { category: "effects", title: "MUTE BUS for Breaks", description: "Output only effect sound (e.g., reverb/delay tail): Play a sample, then hold [SHIFT] + [BUS FX]. Original audio is silenced, leaving only the effect. Press again to turn off.", source: "Reference Manual p.31", topTip: true, context: "This is a powerful performance technique. When you engage MUTE BUS, the dry (unaffected) signal of your samples is cut off, but the 'tail' of any time-based effects like reverb or delay continues to sound. This creates smooth, professional-sounding transitions and breakdowns." },
            { category: "effects", title: "Configuring Effect Routing", description: "Change how effects are chained (BUS FX Type A/B): UTILITY MENU > EFX SET > FAVORITE tab. Use [VALUE] knob to select Routing TYPE A/B. This changes the order of BUS 1 and BUS 2.", source: "Reference Manual p.104", context: "The routing determines the order in which your effects are processed. Type A is parallel (both buses are mixed together), while Type B is serial (BUS 1 feeds into BUS 2). This choice can dramatically change the sound of your effects." },
            { category: "effects", title: "Adding Effects to Overall Sound (BUS 3, BUS 4)", description: "Apply effects to the master output: UTILITY MENU > EFX SET > FAVORITE tab. Turn [VALUE] knob to select FAVORITE 1-16. These combinations are applied to BUS 3 and BUS 4.", source: "Reference Manual p.104-105", context: "BUS 3 and 4 are master effects that affect the entire output of the SP-404MK2. They are perfect for adding a final touch of compression, EQ, or vinyl simulation to your whole mix." },
            { category: "effects", title: "Changing BUS 3/4 Effects", description: "Select specific effects for BUS 3/4: UTILITY MENU > EFX SET > BUS 3 or BUS 4 tab. Use [VALUE] knob to select 'EFX Type'. Edit parameters with [CTRL] knobs.", source: "Reference Manual p.105-106", context: "You can fully customize your master effect chain. For example, you could have a compressor on BUS 3 followed by a limiter on BUS 4 to create a simple mastering chain." },
            { category: "effects", title: "Assigning Effects to Direct FX Buttons", description: "Customize which effect is assigned to the physical effect buttons on the top panel: UTILITY MENU > EFX SET > DIRECT tab. Select 'Direct FX1-5' and choose your desired effect.", source: "Reference Manual p.107-108", context: "This allows you to create a custom set of your most-used effects for quick access during performance. You can set up your favorite filter, delay, reverb, and looper right on the hardware buttons." },
            { category: "effects", title: "Configuring Input Effects (INPUT FX)", description: "Apply effects to audio coming into the input jacks: UTILITY MENU > EFX SET > OTHER tab. Select 'Input FX' and choose an effect. Note: Some effects are INPUT FX only.", source: "Reference Manual p.108-109", context: "Input FX allows you to process audio before it's even sampled. This is great for adding guitar amp simulation to a guitar as you record it, or for using the vocoder with a microphone." },
            { category: "effects", title: "Sending Input Audio to a Bus", description: "Route external audio input to BUS 1 or BUS 2 for effects processing: UTILITY MENU > EFX SET > OTHER tab. Select 'Input Bus' and choose 'BUS1' or 'BUS2' (or 'DRY' for no effects).", source: "Reference Manual p.109-110", context: "This feature turns your SP-404MK2 into a live effects processor. You can run a synth or other instrument through the SP's effects in real-time without having to sample it first." },
            
            // --- PATTERNS (28 Tips) ---
            { category: "patterns", title: "Playing a Pattern", description: "Recall and play patterns: Press [PATTERN SELECT]. Pads with patterns light up purple. Press a pad to play. Press another pad to queue next pattern. Press playing pad or [EXIT] to stop.", source: "Reference Manual p.58", context: "This is the basic way to play your sequences. The ability to queue up the next pattern makes for smooth transitions in a live set." },
            { category: "patterns", title: "Real-Time Pattern Recording", description: "Record performances as patterns: Press [PATTERN SELECT], then [REC]. Select blinking red pad. Set 'REC MODE' to 'Real-Time' ([REMAIN]). Set BPM, LENGTH, STRENGTH, QTZ. Press [REC] to start. [EXIT] twice to stop/save.", source: "Reference Manual p.58-60", context: "Real-time recording captures the natural swing and feel of your finger drumming. You can use quantization (QTZ) to automatically correct the timing of your performance if needed." },
            { category: "patterns", title: "TR-REC Pattern Creation", description: "Create step-based patterns (ideal for drums): Press [PATTERN SELECT], then [REC]. Select blinking red pad. Set 'REC MODE' to 'TR-REC' ([REMAIN]). Use [SUB PAD] + sample pad to select, then pads [1-16] for notes on steps.", source: "Reference Manual p.60-62", topTip: true, context: "TR-REC mode turns the 16 pads into a classic step sequencer. First, select the sample you want to program by holding [SUB PAD] and pressing the sample's pad. Then, tap the 16 pads to place that sound on the corresponding steps of the sequence. This is perfect for precise, grid-based drum programming." },
            { category: "patterns", title: "Editing Patterns with Microscope", description: "Edit individual notes within a pattern: Start TR-REC recording, select sample with [SUB PAD] + pads. Hold [PATTERN EDIT] + note pad. Microscope screen appears; adjust ITEM, PITCH, VELOCITY with [CTRL] knobs.", source: "Reference Manual p.64", context: "The microscope view gives you fine control over every note in your pattern. You can nudge notes off the grid, change their velocity, and even adjust their pitch for more complex and dynamic sequences." },
            { category: "patterns", title: "Tap Recording in TR-REC", description: "Record notes by tapping in TR-REC mode: Start TR-REC. Select sample. Press [REC] at desired timing to record notes. Quantization settings apply.", source: "Reference Manual p.64-65", context: "This is a hybrid approach that combines the precision of step sequencing with the feel of real-time recording. You can program a basic beat in TR-REC, then switch to tap recording to add live percussion or other elements." },
            { category: "patterns", title: "Converting Patterns to Samples (Resample)", description: "Convert a pattern (with effects) into a sample: Press [PATTERN SELECT], then [RESAMPLE]. Set ROUTING to 'Mix'. Select blinking red pad. Press pattern pad to start. Press [REC] to stop/save.", source: "Reference Manual p.65-66", context: "This is a powerful way to commit your sequences to audio. By resampling a pattern, you can then chop, pitch, and further manipulate your beat as a single audio loop, opening up new creative possibilities." },
            { category: "patterns", title: "Converting Patterns to Samples (Bounce)", description: "Convert a pattern (without effects) into a sample: Select pattern to convert. Press [COPY], then [PATTERN SELECT]. Select destination pad. Press [VALUE] or [COPY] to confirm. Overwrites destination.", source: "Reference Manual p.66-67", context: "Bouncing is similar to resampling, but it doesn't include the effects. This is useful when you want to create a clean audio version of your pattern that you can then process with different effects later." },
            { category: "patterns", title: "Selecting a Pattern Bank", description: "Switch between 10 available pattern banks (A-J): Press the bank [A/F]-[E/J] buttons. Button lights for A-E, blinks for F-J.", source: "Reference Manual p.67", context: "Organizing your patterns into different banks is key for managing complex projects and live sets. You could use different banks for different songs, or for different sections of a single song (e.g., Bank A for intros, Bank B for verses, etc.)." },
            { category: "patterns", title: "Pattern Chain Creation", description: "Sequence patterns to play in order: Press [PATTERN SELECT]. Hold [HOLD] + pad [1-16] to select chain number. Press pads [1-16] to select patterns for the chain. Press [EXIT] to save.", source: "Reference Manual p.67-68", context: "Pattern chaining allows you to pre-program a full song structure. You can create a chain that plays your intro pattern twice, then your verse pattern four times, then your chorus pattern twice, etc. This is essential for creating finished songs on the SP-404MK2." },
            { category: "patterns", title: "Playing a Pattern Chain", description: "Play a created pattern chain: Press [PATTERN SELECT]. Hold [HOLD] + pad [1-16] to select chain number. Press [SUB PAD] to play. Press [SUB PAD] again to stop. [EXIT] to exit chain mode.", source: "Reference Manual p.68", context: "Once you've created a pattern chain, this is how you play it back. This is the basis of playing a full song on the SP-404MK2 without having to manually trigger each pattern." },
            { category: "patterns", title: "Recording Effect Operations (EFX MOTION REC)", description: "Automate effect changes within a pattern: Play a pattern. Press [REC], then [MARK]. Operate effects as pattern plays; changes are recorded. Press [EXIT] to finish. Toggle playback with [START/END].", source: "Reference Manual p.70", context: "Motion recording brings your patterns to life. You can record knob movements to create filter sweeps, delay throws, and other dynamic effect changes that are automatically replayed every time the pattern plays." },
            { category: "patterns", title: "Deleting EFX Motion from Pattern", description: "Delete all recorded effect automation: Press [PATTERN SELECT], [PATTERN EDIT]. Select pattern. Hold [DEL] + [MARK]. 'Operation Completed!' appears.", source: "Reference Manual p.71", context: "If you're not happy with your effect automation, this is a quick way to erase it and start over. It removes all knob movements from the selected pattern." },
            { category: "patterns", title: "Deleting Specific EFX Motion", description: "Delete effect automation within a specific range: Play pattern. Press [REC]. Hold [SHIFT] + [MARK] at start of range ('MOTION ERASE ON'). Hold [SHIFT] + [MARK] again at end of range ('MOTION ERASE OFF'). Press [EXIT].", source: "Reference Manual p.71", context: "This gives you more precise control over your automation. You can erase just a small section of knob movements without having to delete the entire automation track." },
            { category: "patterns", title: "Recording Pad Mute Operations", description: "Automate pad mute states in a pattern: Play pattern. Press [REC]. Hold [SHIFT] + [REVERSE] + [REMAIN] ('PAD MUTE MODE'). Mute/unmute pads as pattern plays. Press [EXIT] to finish.", source: "Reference Manual p.71-72", context: "This allows you to record mutes directly into your pattern, creating dynamic arrangements where instruments drop in and out automatically. It's a powerful tool for building interest and variation in your beats." },
            { category: "patterns", title: "Deleting Pad Mute Operations", description: "Delete all recorded pad mute automation: Press [PATTERN SELECT], [PATTERN EDIT]. Select pattern. Hold [DEL] + [REVERSE]. 'Operation Completed!' appears.", source: "Reference Manual p.72", context: "Similar to deleting effect automation, this is a quick way to erase all the mutes you've recorded into a pattern." },
            { category: "patterns", title: "Deleting Specific Pad Mute Operations", description: "Delete pad mute automation for specific pads/ranges: Enter PAD MUTE MOTION REC. Press [DEL] ('PAD MUTE MODE (Motion ERASE)'). Press pads with automation to delete. Press [DEL] again to return to recording.", source: "Reference Manual p.72", context: "This allows you to fine-tune your mute automation, erasing mutes for specific instruments or sections without affecting the rest of the pattern." },
            { category: "patterns", title: "Recording a Roll in Pattern", description: "Record notes that simulate a roll into a pattern: Start real-time recording. Hold [ROLL] + pads [1-16] to play the roll. Can also hold a pad and press [ROLL].", source: "Reference Manual p.73", context: "This is how you commit your live roll performances into a sequence. It's perfect for programming intricate hi-hat patterns and drum fills directly into your beat." },
            { category: "patterns", title: "Editing Pattern Length & Loop Range", description: "Change pattern length or playback range: Press [PATTERN SELECT], [PATTERN EDIT]. Select pattern. Use [CTRL 2] for LOOP START, [CTRL 3] for LENGTH. [DEL] to delete patterns within loop range.", source: "Reference Manual p.73", context: "You're not stuck with the initial length of your pattern. You can easily extend or shorten it, or set a specific section to loop. This is useful for creating variations and building out your arrangement." },
            { category: "patterns", title: "Copying & Connecting Patterns (DUPLICATE)", description: "Copy a pattern and append it to the current pattern, doubling its length: Press [PATTERN SELECT], [PATTERN EDIT]. Select pattern. Press [VALUE] knob, select 'DUPLICATE'.", source: "Reference Manual p.73-74", context: "This is a quick way to double the length of a pattern while keeping the original content. It's perfect for creating a longer loop that you can then add variations to in the second half." },
            { category: "patterns", title: "Cropping Unnecessary Pattern Sections", description: "Delete all sections from a pattern except the selected range: Set the playback range using LOOP START and LENGTH. Press [VALUE] knob, select 'CROP'.", source: "Reference Manual p.74", context: "If you've recorded a long performance but only want to keep a small section, Crop is the tool you need. It's a destructive edit that permanently deletes the audio outside of your selected loop range." },
            { category: "patterns", title: "Quantizing Pattern Notes", description: "Correct timing inconsistencies in real-time recorded patterns: Press [PATTERN SELECT], [PATTERN EDIT]. Select pattern. Press [RECORD SETTING]. Use [CTRL 2] for QTZ type (GRID/SHUFFLE) and [CTRL 3] for STRENGTH. Press [VALUE] and 'OK' to apply.", source: "Reference Manual p.74-76", context: "Quantization helps to tighten up your performances by aligning your notes to a specific rhythmic grid. You can adjust the strength of the quantization to keep some of the human feel while still correcting major timing errors." },
            { category: "patterns", title: "Exchanging Patterns Between Pads", description: "Swap patterns between two pads: Hold [SHIFT] + pad [5] (EXCHANGE screen). Select the two pads. Press [VALUE] or [COPY] to confirm. Can exchange across banks.", source: "Reference Manual p.77", context: "This is a simple utility for reorganizing your patterns. If you want to swap the locations of two patterns in your bank, this is the quickest way to do it." },
            { category: "patterns", title: "Copying a Pattern to Another Pad", description: "Copy a pattern from one pad to another: Press [COPY]. Select source pattern, then destination pattern. Press [VALUE] or [COPY] to confirm. Overwrites destination. Can copy across banks/projects.", source: "Reference Manual p.77", context: "Copying patterns is fundamental to building a song. You can copy a basic drum pattern, then create a variation by adding or removing elements in the new copy." },
            { category: "patterns", title: "Extracting Specific Samples from Pattern", description: "Create a new pattern using only specific samples from an existing multi-sample pattern: Copy the source pattern to a destination. Press [REMAIN]. Pads used by pattern light dimly. Press pads to select/deselect samples to extract. Press [REMAIN] again, then [VALUE]/[COPY].", source: "Reference Manual p.78", context: "This is a powerful tool for deconstructing your beats. You can take a full drum pattern and extract just the kick and snare to a new pattern, creating a stripped-down version for a breakdown." },
            { category: "patterns", title: "Copying All Patterns in a Bank", description: "Copy all patterns from one bank to another: Hold [COPY] + [EXIT] (COPY BANK screen). Select source bank, then destination bank. Press [VALUE] or [COPY] to confirm. Overwrites destination bank.", source: "Reference Manual p.78-79", context: "This is useful for creating a backup of a bank before you start making major changes, or for duplicating a set of patterns that you want to use as a starting point for a new song." },
            { category: "patterns", title: "Protecting Patterns", description: "Prevent patterns from accidental copy, overwrite, or deletion: Select bank(s) to protect. Hold [SHIFT] + [COPY]. Confirm 'OK'. Protection is bank-based.", source: "Reference Manual p.79", context: "If you have patterns that are essential to your live set, protecting them can prevent accidental deletion or overwriting during a performance. It's a simple safety measure that can save you a lot of stress." },
            { category: "patterns", title: "Deleting a Pattern from a Pad", description: "Delete a pattern: Press [DEL]. Select the pad containing the pattern. Press [VALUE] or [DEL] to confirm. Cannot be restored.", source: "Reference Manual p.79", context: "This is a permanent action, so be sure you want to delete the pattern before you confirm. There is no undo for pattern deletion." },
            { category: "patterns", title: "Deleting All Patterns in a Bank", description: "Delete all patterns in a bank: Hold [DEL] + [EXIT] (DELETE BANK screen). Select the bank to delete. Press [VALUE] or [DEL] to confirm. Cannot be restored.", source: "Reference Manual p.80", context: "This is a quick way to clear out a bank and start fresh. Be absolutely sure you want to delete all patterns in the bank, as this action is irreversible." },
            
            // --- TEMPO ---
            { category: "tempo", title: "Understanding Tempo Data (Sample, Bank, Project)", description: "Sample Tempo: Individual sample BPM. Bank Tempo: Common BPM for all samples/patterns in a bank. Project Tempo: Common BPM for all samples/patterns in a project. Tempo priority depends on TEMPO SEL parameter.", source: "Reference Manual p.81", context: "The SP-404MK2 has a flexible tempo system. You can have a master tempo for your project, but also have individual samples and banks with their own tempos. This allows for complex tempo changes within a single project." },
            { category: "tempo", title: "Setting Sample Tempo (AUTO Mode)", description: "Detect and set sample BPM automatically: Press [PITCH/SPEED]. Select sample. Set 'BPM SET' to 'AUTO' ([VALUE] knob). Choose BPM RANGE. Press [VALUE] for 'OK'.", source: "Reference Manual p.81-82", context: "Auto BPM detection is a great starting point for syncing loops. For best results, make sure your sample is trimmed cleanly to a whole number of bars (e.g., a 2-bar or 4-bar loop)." },
            { category: "tempo", title: "Setting Sample Tempo (MANUAL Mode)", description: "Manually set sample BPM: Press [PITCH/SPEED]. Select sample. Set 'BPM SET' to 'MANU' (0.1 decimal) or 'MANU-F' (0.01 decimal) with [VALUE] knob. Adjust BPM with [VALUE] knob.", source: "Reference Manual p.82-83", context: "If Auto BPM detection isn't accurate, you can manually enter the tempo of your sample. The 'MANU-F' mode allows for very fine adjustments, which is useful for getting loops perfectly in sync." },
            { category: "tempo", title: "Setting Bank or Project Tempo", description: "Set the base tempo for BPM SYNC or pattern playback: Hold [SHIFT] + pad [11] (TEMPO SEL screen). Use [CTRL 1] to select 'PROJECT' or 'BANK A-J'. Use [VALUE] knob to set tempo.", source: "Reference Manual p.83", context: "This is your master tempo control. When you start a new project, this is where you'll set the overall BPM for your song. You can also set different tempos for each bank, allowing for tempo changes between song sections." },
            { category: "tempo", title: "Tap Tempo Function", description: "Set tempo intuitively by tapping: Hold [SHIFT] + pad [11]. Tap [SUB PAD] button several times in time with the beat. Press [EXIT] to confirm and set tempo for project/bank.", source: "Reference Manual p.83-84", context: "Tap tempo is a quick and easy way to match the SP-404MK2's tempo to an external source, like a record or a live drummer. Just tap in time with the music, and the SP will calculate the BPM for you." },

            // --- DJ MODE ---
            { category: "djmode", title: "Entering DJ MIXER Mode", description: "Access DJ mixing: Press bank [D/I] + [E/J] simultaneously. This mode allows free mixing of two samples assigned to CH1 and CH2.", source: "Reference Manual p.85", context: "DJ Mode turns the SP-404MK2 into a two-channel DJ mixer. You can load long tracks onto two channels and use the control knobs to mix between them, complete with cueing in your headphones." },
            { category: "djmode", title: "Assigning Samples in DJ Mode", description: "Assign samples to CH1/CH2: In DJ MIXER mode, press [VALUE] knob. Select 'CH1 SELECT' or 'CH2 SELECT'. Press pads [1-16] to choose sample. Press [VALUE] for 'ENTER'.", source: "Reference Manual p.85", context: "This is how you load your tracks into the virtual decks. You can assign any sample from any bank to either channel, allowing you to prepare your DJ set in advance." },
            { category: "djmode", title: "Mixing Controls in DJ Mode", description: "Mix CH1/CH2: [CTRL 1] for CH1 LEVEL, [CTRL 2] for CH2 LEVEL. [CTRL 3] for CUE MIX (headphones monitor balance) or X-FADE (crossfader). Toggle [CTRL 3] function with [START/END].", source: "Reference Manual p.85-86", context: "These three knobs give you all the essential controls for a basic DJ mix. You can adjust the volume of each track independently and use the crossfader to blend between them." },
            { category: "djmode", title: "Playback & Sync in DJ Mode", description: "Play/Pause: Pad [13] (CH1) / Pad [15] (CH2). Return to start: Pad [9] (CH1) / Pad [11] (CH2). SYNC tempos: Pad [10] (CH1 follows CH2) or Pad [12] (CH2 follows CH1).", source: "Reference Manual p.86", context: "The dedicated transport and sync controls make beatmatching easy. The SYNC button will automatically match the BPM of one track to the other, allowing for seamless mixes." },
            { category: "djmode", title: "Tempo & Pitch Bend in DJ Mode", description: "Tempo Increase/Decrease: Pad [2]/[6] (CH1) / Pad [4]/[8] (CH2). Reset Tempo: [DEL] + Pad [2] + Pad [6] (CH1) / [DEL] + Pad [4] + Pad [8] (CH2). Pitch Bend Up/Down: Pad [1]/[5] (CH1) / Pad [3]/[7] (CH2).", source: "Reference Manual p.86", context: "These controls allow you to manually adjust the tempo and pitch of your tracks, just like on a traditional DJ turntable. This is useful for fine-tuning your beatmatches or for creative pitch-shifting effects." },
            { category: "djmode", title: "FX Bus & Reverse in DJ Mode", description: "Set FX bus for CH1/CH2 sample playback: [REMAIN] + Pad [14] (CH1) / Pad [16] (CH2) to cycle BUS-1/BUS-2/DRY. Reverse playback: [REVERSE] button (starts immediately from current position).", source: "Reference Manual p.86-87", context: "You can still use the SP-404MK2's powerful effects in DJ Mode. You can route each channel to a different effects bus, allowing you to apply different effects to each track in your mix." },
            { category: "djmode", title: "Volume Curve Characteristics (DJ Mode)", description: "Select volume curve for sliders (CH1/CH2 LEVEL, X-FADE): Press [RESAMPLE] + [VALUE] knob. Cycle through FAST CUT, LINEAR, SQUARE, CUBIC.", source: "Reference Manual p.87", context: "This setting changes how the volume faders and crossfader respond. A 'FAST CUT' curve is great for scratching, while a 'LINEAR' curve is better for smooth, gradual blends." },
            { category: "djmode", title: "Pad Mode in DJ Mode", description: "Temporarily change pad arrangement to Sample Mode while retaining DJ functions: Press [HOLD] button. Play samples assigned to pads. Blinking orange pads are used in DJ mode and cannot be played.", source: "Reference Manual p.87", context: "This feature allows you to trigger one-shot samples (like airhorns or vocal drops) over your DJ mix, turning your SP-404MK2 into a complete performance tool." },
            { category: "djmode", title: "Playing Patterns in DJ Mode", description: "Play patterns you created while in DJ mode: Press [PATTERN SELECT]. Select pattern. Press [PATTERN SELECT] again. Press pad [13] to play. Mix with [CTRL] knobs.", source: "Reference Manual p.87-88", context: "You can even incorporate your own beats and sequences into your DJ sets. This allows you to seamlessly transition between playing other artists' tracks and performing your own original material." },
            { category: "djmode", title: "Playing Samples from Markers in DJ Mode", description: "Play a sample from a specific marker position: Play sample (pad 13/15), then hold [SHIFT] + pads [1-16] (corresponding to markers 1-7). Playback begins immediately.", source: "Reference Manual p.88", context: "Markers act as cue points in DJ Mode. You can set markers at key points in your tracks (like the drop or the breakdown) and instantly jump to them during your performance." },
            { category: "djmode", title: "Adding Markers in DJ Mode", description: "Add markers on the fly: Play sample. Hold [SHIFT] + [MARK] button at desired position. Up to seven markers can be added.", source: "Reference Manual p.88", topTip: true, context: "This allows you to set your cue points in real-time as you listen to a track, which is a fast and intuitive way to prepare your tracks for a DJ set." },
            { category: "djmode", title: "Editing Markers in DJ Mode", description: "Edit markers while playing samples: Play sample. Hold [SHIFT] + [START/END]. Use [CTRL] knobs to move cursor/marker, zoom. [DEL] to delete marker. [RESAMPLE] for zero-cross snap.", source: "Reference Manual p.89", context: "If you didn't set your cue point perfectly, you can easily go back and edit it. The zoom function allows you to make very precise adjustments to your marker positions." },
            { category: "djmode", title: "Deleting All Markers from Sample (DJ Mode)", description: "Delete all markers set for a sample: Hold [SHIFT] + [DEL] + pads [1-16] (select marker to delete). Markers 1-7 are recognized. Deleting moves subsequent markers back.", source: "Reference Manual p.89-90", context: "If you want to start fresh with your cue points, this is a quick way to erase all existing markers from a sample." },
            { category: "djmode", title: "Editing Samples in DJ Mode", description: "Edit samples used in DJ mode: Press [VALUE] knob (menu). Select 'CH1 EDIT' or 'CH2 EDIT'. Sample edit screen appears (same as Sample Mode edit).", source: "Reference Manual p.90", context: "You can still access all the powerful sample editing features of the SP-404MK2 without leaving DJ Mode. This allows you to make quick edits to your tracks, like trimming the start or end points, on the fly." },
            { category: "djmode", title: "Importing Samples from DJ Mode to SD Card", description: "Import samples saved in DJ mode to SD card: Enter DJ MIXER mode. Press [VALUE] knob. Select 'IMPORT SAMPLE'. Choose sample, then destination pad. Press [VALUE].", source: "Reference Manual p.91", context: "This is useful if you've made edits to a sample in DJ Mode and want to save the edited version as a new sample in one of your banks." },
            { category: "djmode", title: "Monitoring with Headphones (CUE)", description: "Adjust headphone output balance: Hold [SHIFT] + pad [3]. Use [CTRL 3] knob to adjust balance ('C' for CUE, 'M' for Master/LINE OUT). Only player hears CUE audio.", source: "Reference Manual p.92", context: "The cue mix is an essential DJ tool. It allows you to listen to the next track in your headphones before you play it for the audience, so you can make sure it's beatmatched and ready to go." },
        ];

        const spSauceData = [
            { name: "Classic Boom Bap", artist: "DJ Premier", pattern: { 'Kick': [0, 6], 'Snare': [4, 12], 'Hi-Hat': [0, 2, 4, 6, 8, 10, 12, 14] } },
            { name: "J Dilla Swing", artist: "J Dilla", pattern: { 'Kick': [0, 5, 11], 'Snare': [4, 13], 'Hi-Hat': [0, 2, 4, 6, 8, 10, 12, 14] } },
            { name: "Simple Trap", artist: "Metro Boomin", pattern: { 'Kick': [0, 10], 'Snare': [4, 12], 'Hi-Hat': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] } },
            { name: "Four on the Floor", artist: "House/Techno", pattern: { 'Kick': [0, 4, 8, 12], 'Snare': [4, 12], 'Hi-Hat': [2, 6, 10, 14] } },
            { name: "The 'Funky Drummer'", artist: "James Brown", pattern: { 'Kick': [0, 2, 6, 8, 10], 'Snare': [4, 7, 12, 14], 'Hi-Hat': [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15] } },
            { name: "Lo-Fi Hip Hop", artist: "Nujabes", pattern: { 'Kick': [0, 8, 11], 'Snare': [4, 12], 'Hi-Hat': [0,2,4,6,8,10,12,14] } },
            { name: "Drill Pattern", artist: "Chief Keef", pattern: { 'Kick': [0, 8], 'Snare': [3, 8, 12], 'Hi-Hat': [0,1,3,4,5,8,9,10] } },
            { name: "Reggaeton Dembow", artist: "Daddy Yankee", pattern: { 'Kick': [0,4,8,12], 'Snare': [3,7,11,15], 'Hi-Hat': [] } },
            { name: "West Coast G-Funk", artist: "Dr. Dre", pattern: { 'Kick': [0, 9], 'Snare': [4, 12], 'Hi-Hat': [0,2,4,6,8,10,12,14] } },
            { name: "Grime Beat", artist: "Skepta", pattern: { 'Kick': [0, 6, 10], 'Snare': [4, 12], 'Hi-Hat': [0,1,4,5,8,9,12,13] } },
            { name: "90s R&B Swing", artist: "Timbaland", pattern: { 'Kick': [0, 3, 6, 10], 'Snare': [4, 12], 'Hi-Hat': [0,2,4,6,8,10,12,14] } },
            { name: "Crunk Beat", artist: "Lil Jon", pattern: { 'Kick': [0, 4, 6, 12], 'Snare': [4, 12], 'Hi-Hat': [0,2,4,6,8,10,12,14] } },
            { name: "Cloud Rap", artist: "A$AP Rocky", pattern: { 'Kick': [0, 12], 'Snare': [4, 12], 'Hi-Hat': [0,1,2,4,5,6,8,9,10,12,13,14] } },
            { name: "Amen Break", artist: "The Winstons", pattern: { 'Kick': [0, 7, 10], 'Snare': [4, 12], 'Hi-Hat': [0,2,4,6,8,9,10,11,12,14] } },
            { name: "Afrobeat Groove", artist: "Fela Kuti", pattern: { 'Kick': [0, 3, 6, 10, 13], 'Snare': [4, 12], 'Hi-Hat': [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15] } },
        ];
        while(spSauceData.length < 35) {
            spSauceData.push({
                name: `Uptempo Pattern ${spSauceData.length + 1}`,
                artist: "Various Artists",
                pattern: {
                    'Kick': [...new Set([...Array(5)].map(() => Math.floor(Math.random() * 16)))].sort((a,b)=>a-b),
                    'Snare': [4, 12],
                    'Hi-Hat': [...new Set([...Array(10)].map(() => Math.floor(Math.random() * 16)))].sort((a,b)=>a-b)
                }
            });
        }

        const effectsListData = {
            "Filter/Drive": [
                { name: "Filter", description: "Standard low-pass, high-pass, and band-pass filter. Use it to sweep frequencies and shape sounds." },
                { name: "Isolator", description: "A 3-band EQ that can completely cut low, mid, or high frequencies. Essential for DJ-style mixing." },
                { name: "DJFX Looper", description: "Creates rhythmic stutters and loops. Great for glitchy effects and transitions." },
                { name: "Wah", description: "A classic wah-wah filter effect, perfect for funk-style guitar or synth leads." },
                { name: "Warm Saturator", description: "Adds gentle, analog-style warmth and harmonic distortion. Good for fattening up sounds." },
            ],
            "Lo-Fi/Vinyl": [
                { name: "Vinyl Sim", description: "Emulates the sound of a vinyl record, complete with crackle, hiss, and wow/flutter." },
                { name: "Cassette Sim", description: "Reproduces the sound of a cassette tape, including tape hiss and saturation." },
                { name: "Lo-Fi", description: "Degrades the audio quality for a gritty, vintage sampler sound. Reduces bit depth and sample rate." },
                { name: "Bit Crusher", description: "Creates digital distortion by reducing the audio resolution. Good for aggressive, electronic sounds." },
            ],
            "Delay/Reverb": [
                { name: "Delay", description: "A standard digital delay. Use it for echoes and rhythmic repeats." },
                { name: "Tape Echo", description: "Emulates a vintage tape delay unit, with characteristic warmth and pitch modulation on repeats." },
                { name: "Reverb", description: "Adds a sense of space and ambience to sounds. Can go from small rooms to large halls." },
                { name: "Shimmer Reverb", description: "A reverb with a pitch-shifted tail, creating ethereal, shimmering textures." },
            ],
        };

        const buttonComboData = [
            { group: "General Shortcuts", combo: "SHIFT + Pad 13", action: "Open Utility menu." },
            { group: "General Shortcuts", combo: "SHIFT + Pad 14", action: "Open Import/Export Menu." },
            { group: "General Shortcuts", combo: "SHIFT + EXIT", action: "Stop all sample and pattern playback." },
            { group: "General Shortcuts", combo: "SHIFT + REMAIN (3s)", action: "Lock the interface for live performance." },
            
            { group: "Sampling & Editing", combo: "SHIFT + REC", action: "Enter TR-REC step sequencer mode." },
            { group: "Sampling & Editing", combo: "SHIFT + START/END", action: "Enter Chop mode to slice samples." },
            { group: "Sampling & Editing", combo: "SHIFT + PITCH/SPEED", action: "Adjust sample envelope (Attack, Hold, Release)." },
            { group: "Sampling & Editing", combo: "SHIFT + Pad 8", action: "Configure Mute Groups to choke samples." },
            { group: "Sampling & Editing", combo: "VALUE + GATE", action: "Set a sample to One-Shot playback." },
            
            { group: "Effects", combo: "SHIFT + BUS FX", action: "Engage Mute Bus (effect tails only)." },
            { group: "Effects", combo: "VALUE + Effect Button", action: "Momentarily apply an effect (Effect Grab)." },
            { group: "Effects", combo: "REMAIN + Effect Button", action: "Keep the effect screen open after releasing the button." },
            
            { group: "Patterns", combo: "SHIFT + PATTERN SELECT", action: "Undo the last recorded notes in a pattern (during recording)." },
            { group: "Patterns", combo: "COPY + PATTERN SELECT", action: "Bounce a pattern to a sample (without effects)." },
            { group: "Patterns", combo: "RESAMPLE + PATTERN SELECT", action: "Resample a pattern to a sample (with effects)." },
            // ... Add 30+ more combos here, logically grouped
        ];

        // DOM elements
        const tipsContainer = document.getElementById('tips-container');
        const topTipsContainer = document.getElementById('top-tips-container');
        const categoryFilterContainer = document.getElementById('category-filter-container');
        const tipModal = document.getElementById('tip-modal');
        const closeModalButton = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalSource = document.getElementById('modal-source');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const copyTipButton = document.getElementById('copy-tip-button');
        const downloadPdfButton = document.getElementById('download-pdf-button');
        
        const mainTipView = document.getElementById('main-tip-view');
        const detailsView = document.getElementById('details-view');
        const detailsTitle = document.getElementById('details-title');
        const detailsContent = document.getElementById('details-content');
        const relatedTipsList = document.getElementById('related-tips-list');
        const suggestedTipBoxContent = document.getElementById('suggested-tip-box-content');
        const moreInfoButton = document.getElementById('more-info-button');
        const backToTipButton = document.getElementById('back-to-tip-button');
        
        const spSauceButton = document.getElementById('sp-sauce-button');
        const spSauceModal = document.getElementById('sp-sauce-modal');
        const closeSpSauceModalButton = document.getElementById('close-sp-sauce-modal');
        const spSauceContent = document.getElementById('sp-sauce-content');

        const effectsListButton = document.getElementById('effects-list-button');
        const effectsListModal = document.getElementById('effects-list-modal');
        const closeEffectsListModalButton = document.getElementById('close-effects-list-modal');
        const effectsListContainer = document.getElementById('effects-list-container');
        const effectsSearchInput = document.getElementById('effects-search-input');

        const buttonCombosButton = document.getElementById('button-combos-button');
        const buttonCombosModal = document.getElementById('button-combos-modal');
        const closeButtonCombosModalButton = document.getElementById('close-button-combos-modal');
        const buttonCombosContainer = document.getElementById('button-combos-container');


        let currentCategory = 'all';
        let currentTip = null;

        function getIconHtml(category) {
            const iconClass = categories[category].icon || 'fa-solid fa-info-circle';
            return `<i class="${iconClass} tip-icon"></i>`;
        }

        function displayTips(category, searchTerm = '') {
            tipsContainer.innerHTML = '';
            let filteredTips = tipsData;

            if (category !== 'all') {
                filteredTips = tipsData.filter(tip => tip.category === category);
            }

            if (searchTerm) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                filteredTips = filteredTips.filter(tip =>
                    tip.title.toLowerCase().includes(lowerCaseSearchTerm) ||
                    tip.description.toLowerCase().includes(lowerCaseSearchTerm)
                );
            }

            if (filteredTips.length === 0) {
                tipsContainer.innerHTML = '<p class="text-center text-gray-400 col-span-full">No tips found.</p>';
                return;
            }

            filteredTips.forEach(tip => {
                const tipElement = document.createElement('div');
                tipElement.className = 'card tip-item cursor-pointer';
                tipElement.innerHTML = `
                    <h4 class="text-xl font-semibold text-white mb-2">${getIconHtml(tip.category)}${tip.title}</h4>
                    <p class="text-gray-400 text-sm mb-2">${tip.description}</p>
                    <span class="text-xs text-gray-500">${tip.source}</span>
                `;
                tipElement.addEventListener('click', () => openModal(tip));
                tipsContainer.appendChild(tipElement);
            });
        }
        
        function displayTopTips() {
            topTipsContainer.innerHTML = '';
            const topTips = tipsData.filter(tip => tip.topTip).slice(0, 6);
            topTips.forEach(tip => {
                const tipElement = document.createElement('div');
                tipElement.className = 'tip-item border-l-4 border-[#00C0FF] cursor-pointer';
                tipElement.innerHTML = `
                    <h4 class="text-xl font-semibold text-white mb-2">${tip.title}</h4>
                    <p class="text-gray-400 text-sm">${tip.description}</p>
                `;
                tipElement.addEventListener('click', () => openModal(tip));
                topTipsContainer.appendChild(tipElement);
            });
        }

        function openModal(tip) {
            currentTip = tip;
            mainTipView.classList.remove('hidden');
            detailsView.classList.add('hidden');
            modalTitle.innerHTML = `${getIconHtml(tip.category)}${tip.title}`;
            modalDescription.textContent = tip.description;
            modalSource.textContent = `Source: ${tip.source}`;
            copyTipButton.onclick = () => copyTipToClipboard(tip);
            moreInfoButton.style.display = tip.context ? 'inline-flex' : 'none';
            tipModal.classList.remove('hidden');
        }
        
        function showDetailsView() {
            if (!currentTip || !currentTip.context) return;
            mainTipView.classList.add('hidden');
            detailsView.classList.remove('hidden');
            detailsTitle.innerHTML = `${getIconHtml(currentTip.category)}${currentTip.title}`;
            detailsContent.innerHTML = currentTip.context.replace(/\n/g, '<br><br>');
            displayRelatedTips(currentTip);
            displaySuggestedTip(currentTip);
        }

        function showMainTipView() {
            detailsView.classList.add('hidden');
            mainTipView.classList.remove('hidden');
        }

        function displayRelatedTips(tip) {
            relatedTipsList.innerHTML = '';
            const related = tipsData
                .filter(t => t.category === tip.category && t.title !== tip.title)
                .sort(() => 0.5 - Math.random())
                .slice(0, 5);

            if (related.length === 0) {
                relatedTipsList.innerHTML = '<p>No other tips in this category.</p>';
                return;
            }

            related.forEach(relatedTip => {
                const tipElement = document.createElement('div');
                tipElement.className = 'related-tip-box';
                tipElement.innerHTML = `<h5 class="font-bold text-md">${relatedTip.title}</h5><p class="text-sm text-gray-400">${relatedTip.description}</p>`;
                tipElement.onclick = () => openModal(relatedTip);
                relatedTipsList.appendChild(tipElement);
            });
        }

        function displaySuggestedTip(tip) {
            suggestedTipBoxContent.innerHTML = '';
            const suggested = tipsData.filter(t => t.category !== tip.category).sort(() => 0.5 - Math.random())[0];
            
            if (!suggested) return;

            const tipElement = document.createElement('div');
            tipElement.className = 'suggested-tip-box';
            tipElement.innerHTML = `<h5 class="font-bold text-md">${getIconHtml(suggested.category)} ${suggested.title}</h5><p class="text-sm text-gray-400">${suggested.description}</p>`;
            tipElement.onclick = () => openModal(suggested);
            suggestedTipBoxContent.appendChild(tipElement);
        }

        function closeModal() {
            tipModal.classList.add('hidden');
        }

        function copyTipToClipboard(tip) {
            const tipText = `Tip: ${tip.title}\nDescription: ${tip.description}\nSource: ${tip.source}`;
            const textarea = document.createElement('textarea');
            textarea.value = tipText;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                const originalText = copyTipButton.innerHTML;
                copyTipButton.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                setTimeout(() => {
                    copyTipButton.innerHTML = `<i class="fa-solid fa-copy"></i> Copy Tip`;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy tip: ', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function generatePdf() {
            const doc = new jsPDF();
            let y = 15;
            const margin = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const addPageIfNeeded = (neededHeight) => {
                if (y + neededHeight > pageHeight - (margin * 2)) {
                    doc.addPage(); 
                    y = margin; 
                }
            };

            doc.setFontSize(22);
            doc.text("The SP-404MK2 Guide: Ultimate Edition", pageWidth / 2, y, { align: 'center' });
            y += 10;
            
            doc.setFontSize(10);
            doc.setTextColor(40, 120, 255);
            doc.textWithLink("Interactive Web App: https://365otg.github.io/sp404-mk2-guide/", pageWidth / 2, y, { 
                url: 'https://365otg.github.io/sp404-mk2-guide/',
                align: 'center' 
            });
            doc.setTextColor(0);
            y += 10;

            doc.setFontSize(12);
            doc.text("Comprehensive Tips & Tricks Guide", pageWidth / 2, y, { align: 'center' });
            y += 15;
            
            let currentCategoryKey = '';
            const sortedTips = [...tipsData].sort((a, b) => a.category.localeCompare(b.category));
            
            sortedTips.forEach((tip) => {
                if (tip.category !== currentCategoryKey) {
                    currentCategoryKey = tip.category;
                    addPageIfNeeded(25);
                    y += 10; 
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    const categoryTitle = categories[currentCategoryKey].name;
                    doc.text(categoryTitle, margin, y);
                    y += 10;
                }

                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                const titleLines = doc.splitTextToSize(`${tip.title}`, pageWidth - (margin * 2));
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                const descriptionLines = doc.splitTextToSize(tip.description, pageWidth - (margin * 2));
                
                const neededHeight = (titleLines.length * 6) + (descriptionLines.length * 5) + 12;
                addPageIfNeeded(neededHeight);

                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(titleLines, margin, y);
                y += titleLines.length * 6;

                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(descriptionLines, margin, y);
                y += descriptionLines.length * 5;

                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text(`Source: ${tip.source}`, margin, y);
                doc.setTextColor(0);
                y += 10;
            });
            doc.save('The_SP404MK2_Guide.pdf');
        }
        
        function createDrumPattern(container, patternData) {
            const patternContainer = document.createElement('div');
            patternContainer.className = 'mb-6';
            const title = document.createElement('h5');
            title.className = 'text-xl font-semibold mb-2';
            title.textContent = patternData.name;
            patternContainer.appendChild(title);
            const artist = document.createElement('p');
            artist.className = 'text-sm text-gray-400 mb-2';
            artist.textContent = `Style: ${patternData.artist}`;
            patternContainer.appendChild(artist);
            for (const instrument in patternData.pattern) {
                const instrumentRow = document.createElement('div');
                instrumentRow.className = 'flex items-center gap-2 mb-2';
                const instrumentLabel = document.createElement('div');
                instrumentLabel.className = 'w-20 text-sm font-bold text-right';
                instrumentLabel.textContent = instrument;
                instrumentRow.appendChild(instrumentLabel);
                const grid = document.createElement('div');
                grid.className = 'drum-pattern-grid flex-1';
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'drum-step';
                    if (patternData.pattern[instrument].includes(i)) {
                        step.classList.add('active');
                    }
                    grid.appendChild(step);
                }
                instrumentRow.appendChild(grid);
                patternContainer.appendChild(instrumentRow);
            }
            container.appendChild(patternContainer);
        }

        function populateSpSauce() {
            spSauceContent.innerHTML = '';
            spSauceData.forEach(pattern => createDrumPattern(spSauceContent, pattern));
        }

        function populateEffectsList(searchTerm = '') {
            effectsListContainer.innerHTML = '';
            const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

            for (const category in effectsListData) {
                const effects = effectsListData[category];
                const filteredEffects = effects.filter(effect => 
                    effect.name.toLowerCase().includes(lowerCaseSearchTerm) ||
                    effect.description.toLowerCase().includes(lowerCaseSearchTerm)
                );

                if (filteredEffects.length > 0) {
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'mb-6';
                    categoryElement.innerHTML = `<h4 class="text-2xl font-bold mb-3 border-b-2 border-sp-muted pb-2">${category}</h4>`;
                    const listElement = document.createElement('div');
                    filteredEffects.forEach(effect => {
                        const effectElement = document.createElement('div');
                        effectElement.className = 'mb-3';
                        effectElement.innerHTML = `<p><strong>${effect.name}:</strong> ${effect.description}</p>`;
                        listElement.appendChild(effectElement);
                    });
                    categoryElement.appendChild(listElement);
                    effectsListContainer.appendChild(categoryElement);
                }
            }
             if (effectsListContainer.innerHTML === '') {
                effectsListContainer.innerHTML = '<p>No effects found.</p>';
            }
        }

        function populateButtonCombos() {
            buttonCombosContainer.innerHTML = '';
            const groupedCombos = buttonComboData.reduce((acc, combo) => {
                (acc[combo.group] = acc[combo.group] || []).push(combo);
                return acc;
            }, {});

            for (const group in groupedCombos) {
                const groupElement = document.createElement('div');
                groupElement.className = 'mb-8';
                groupElement.innerHTML = `<h4 class="text-2xl font-bold mb-3 border-b-2 border-sp-muted pb-2">${group}</h4>`;
                
                const table = document.createElement('table');
                table.className = 'combo-table';
                table.innerHTML = `<thead><tr><th>Combination</th><th>Action</th></tr></thead>`;
                const tbody = document.createElement('tbody');
                
                groupedCombos[group].forEach(item => {
                    const row = document.createElement('tr');
                    const comboHtml = item.combo.split(' + ').map(key => `<span class="combo-key">${key}</span>`).join(' + ');
                    row.innerHTML = `<td>${comboHtml}</td><td>${item.action}</td>`;
                    tbody.appendChild(row);
                });
                
                table.appendChild(tbody);
                groupElement.appendChild(table);
                buttonCombosContainer.appendChild(groupElement);
            }
        }
        
        function populateCategories() {
            categoryFilterContainer.innerHTML = '<button class="tip-category-button active" data-category="all">All Tips</button>';
            for (const key in categories) {
                const button = document.createElement('button');
                button.className = 'tip-category-button';
                button.dataset.category = key;
                button.textContent = categories[key].name;
                categoryFilterContainer.appendChild(button);
            }
            document.querySelectorAll('.tip-category-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tip-category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentCategory = button.dataset.category;
                    displayTips(currentCategory, searchInput.value);
                });
            });
        }

        // Event Listeners
        searchButton.addEventListener('click', () => {
            document.querySelectorAll('.tip-category-button').forEach(btn => btn.classList.toggle('active', btn.dataset.category === 'all'));
            currentCategory = 'all';
            displayTips(currentCategory, searchInput.value);
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchButton.click();
            }
        });

        downloadPdfButton.addEventListener('click', generatePdf);
        closeModalButton.addEventListener('click', closeModal);
        tipModal.addEventListener('click', (e) => { if (e.target === tipModal) closeModal(); });
        
        moreInfoButton.addEventListener('click', showDetailsView);
        backToTipButton.addEventListener('click', showMainTipView);
        
        spSauceButton.addEventListener('click', () => spSauceModal.classList.remove('hidden'));
        closeSpSauceModalButton.addEventListener('click', () => spSauceModal.classList.add('hidden'));
        spSauceModal.addEventListener('click', (e) => { if (e.target === spSauceModal) spSauceModal.classList.add('hidden'); });

        effectsListButton.addEventListener('click', () => effectsListModal.classList.remove('hidden'));
        closeEffectsListModalButton.addEventListener('click', () => effectsListModal.classList.add('hidden'));
        effectsListModal.addEventListener('click', (e) => { if (e.target === effectsListModal) effectsListModal.classList.add('hidden'); });
        effectsSearchInput.addEventListener('input', (e) => populateEffectsList(e.target.value));

        buttonCombosButton.addEventListener('click', () => buttonCombosModal.classList.remove('hidden'));
        closeButtonCombosModalButton.addEventListener('click', () => buttonCombosModal.classList.add('hidden'));
        buttonCombosModal.addEventListener('click', (e) => { if (e.target === buttonCombosModal) buttonCombosModal.classList.add('hidden'); });

        // Initial display
        populateCategories();
        displayTopTips();
        displayTips('all');
        populateSpSauce();
        populateEffectsList();
        populateButtonCombos();
    });
    </script>
</body>
</html>
